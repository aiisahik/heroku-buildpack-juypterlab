#!/usr/bin/env bash
#
set -eo pipefail

indent() {
  sed -u 's/^/       /'
}



echo "-----> Retrieve environment variables"
# BUILD_DIR=$1
# CACHE_DIR=$2
# ENV_DIR=$3

# for KEY in ENVIRONMENT_YML ADDITIONAL_ENVIRONMENT_YML; do
#   [ -f $ENV_DIR/$KEY ] && export "$KEY=$(cat $ENV_DIR/$KEY)" 
# done
# [ -z "$ENVIRONMENT_YML" ] || echo "ENVIRONMENT_YML: $ENVIRONMENT_YML"
# [ -z "$ADDITIONAL_ENVIRONMENT_YML" ] || echo "ADDITIONAL_ENVIRONMENT_YML: $ADDITIONAL_ENVIRONMENT_YML"

echo "-----> Starting compile step..."
mkdir -p "$1" "$2"
build=$(cd "$1/" && pwd)
cache=$(cd "$2/" && pwd)

echo "-----> Cache dir: $cache"
echo "-----> Build dir: $build"
echo "-----> APP_TYPE: $APP_TYPE"


echo "-----> Finished compile step"

echo "-----> Create .profile.d"
# mkdir -p $build/.profile.d
# 	cat <<-'EOF' > $build/.profile.d/conda.sh
# 	# append to path variable
# 	export PATH=$HOME/.conda/bin:$PATH
# 	source activate root
	
# 	# set default encoding to UTF-8
# 	export LC_ALL=C.UTF-8
# 	export LANG=C.UTF-8  
# EOF

echo "-----> Purging cache"
rm -rf $cache/*
